import compiler for Option, Some, None, assert, unsafe_enum_cast, is_enum_variant

fn is_some!(T)(x: Option!T) -> bool @inline:
  if x is Some:
    return true
  return false

fn test_various():
  let a : Option!int
  a = Some(78)

  let b : Option!int = Some(124)

  let x = None!int()
  let y = Some(10)
  # let g = 10.Some

  let v: Option!int = None()
  v = None()
  # let v2 = None()
  print(v)

  y = Some(32)

  let d = y is Some

  if x is Some:
    let f = unsafe_enum_cast!Some(y)
    print(f.value + 123)
  else:
    print("None")

  print(x)
  print(y)

  let z = x.orelse 69
  let w = y.orelse 100
  print(z + w)

  let asd = { x? + y? }.orelse 3
  assert(asd == 3)

  x = Some(16)

  let asd2 = { x? + y? }.orelse 3
  assert(asd2 == 48)

  print({ x? + y? })

  let asd3 = { 2 + 3 }
  print(asd3)

  # let x = ifx {
  #   x? + y?
  # } else {
  # }

  if x.is_some:
    print(x)
  else:
    print("None", x)

  x = None!int()


  let u = x.orelse return
  print(u)
  print("Should not print")
  assert(1 == 0)


fn test_or_else():
  let x = None!int()
  let z = x.orelse 69
  assert(z == 69)

fn test_question_or_else():
  let x = None!int()
  let y = None!int()
  let z = { x? + y? }.orelse 3
  assert(z == 3)

fn main():
  test_various()
  test_or_else()
  test_question_or_else()