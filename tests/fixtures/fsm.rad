import compiler for fsm, concat
import range for Range

fn foop(x: int):

  foo :: |yield|
    for i in Range(0, x):
      yield(i)

  bar :: |yield|
    for i in Range(1, 9):
      yield(i * i)

  bamp :: |yield|
    for i in Range(1, 9):
      yield(i * i * i)

  baz :: |yield|
    f := 1
    while true:
      yield(f)
      f *= 2

  consume :: |yield|
    while true:
      val := yield()
      print(val)
  

  consume2 :: |yield|
    val := yield()
    print("val 1", val)
    val = yield()
    print("val 2", val)
    val = yield()
    print("val 3", val)
    val = yield()
    print("val 4", val)

  
  print("OK")

  fsm!(foo, consume2)()

  printer :: {|x| print(x) }
  foo_then_bar :: concat(concat(foo, bar), bamp)
  
  foo_then_bar(printer)
  
  # thing :: concat(foo, bar)
  # concat!(foo, bar)()

  # zip!(foo, bar, consume)()

fn main():
  foop(10)